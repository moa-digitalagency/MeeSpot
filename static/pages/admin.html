<!DOCTYPE html>
<!--
MeetSpot
MOA Digital Agency LLC
Par : Aisance KALONJI
Mail : moa@myoneart.com
www.myoneart.com
-->

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MeetSpot - Admin Dashboard</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#FF4458">
    <script src="/css/tailwind.js"></script>
    <link href="/css/fonts.css" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; padding-bottom: 80px; max-width: 768px; margin: 0 auto; }
        h1, h2, h3, h4, h5, h6 { font-family: 'Poppins', sans-serif; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; max-width: 768px; margin: 0 auto; background: white; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 50; }
        .nav-item { transition: all 0.2s; }
        .nav-item.active { color: #FF4458; }
        .nav-item svg { width: 24px; height: 24px; }
    </style>
</head>
<body class="bg-[#FFEAA7]">
    <div id="page-dashboard" class="page-content">
        <div class="px-4 pt-4">
            <div class="flex items-center justify-between mb-2">
                <div>
                    <h1 class="text-2xl font-bold text-[#2D3436] mb-1">Admin Dashboard</h1>
                    <p class="text-sm text-[#2D3436] opacity-75">Gestion de la plateforme</p>
                </div>
                <button onclick="logout()" class="px-4 py-2 bg-red-500 text-white rounded-full text-sm font-semibold hover:bg-red-600 transition">
                    üö™ D√©connexion
                </button>
            </div>
        </div>

        <div class="px-4 space-y-3 mb-4">
            <div class="bg-gradient-to-br from-[#FF4458] to-[#e03d4c] rounded-2xl p-5 text-white">
                <div class="text-sm opacity-90 mb-1">Utilisateurs totaux</div>
                <div id="totalUsers" class="text-3xl font-bold">0</div>
            </div>
            <div class="bg-gradient-to-br from-[#6C5CE7] to-[#5a4dd9] rounded-2xl p-5 text-white">
                <div class="text-sm opacity-90 mb-1">Rooms actives</div>
                <div id="totalRooms" class="text-3xl font-bold">0</div>
            </div>
            <div class="bg-gradient-to-br from-[#00B894] to-[#00a183] rounded-2xl p-5 text-white">
                <div class="text-sm opacity-90 mb-1">√âtablissements</div>
                <div id="totalEstablishments" class="text-3xl font-bold">0</div>
            </div>
            <div class="bg-gradient-to-br from-[#A29BFE] to-[#9189f7] rounded-2xl p-5 text-white">
                <div class="text-sm opacity-90 mb-1">Signalements en attente</div>
                <div id="totalReports" class="text-3xl font-bold">0</div>
            </div>
        </div>
    </div>

    <div id="page-users" class="page-content hidden">
        <div class="px-4 pt-4 pb-4">
            <div class="flex items-center justify-between mb-4">
                <h1 class="text-2xl font-bold text-[#2D3436]">Utilisateurs</h1>
                <button onclick="logout()" class="px-4 py-2 bg-red-500 text-white rounded-full text-sm font-semibold hover:bg-red-600 transition">
                    üö™ D√©connexion
                </button>
            </div>
            <div id="usersList" class="space-y-3">
                <p class="text-[#2D3436] opacity-75">Chargement...</p>
            </div>
        </div>
    </div>

    <div id="page-options" class="page-content hidden">
        <div class="px-4 pt-4 pb-4">
            <div class="flex items-center justify-between mb-2">
                <div>
                    <h1 class="text-2xl font-bold text-[#2D3436] mb-1">Options de Profil</h1>
                    <p class="text-sm text-[#2D3436] opacity-75">G√©rer les options personnalisables</p>
                </div>
                <button onclick="logout()" class="px-4 py-2 bg-red-500 text-white rounded-full text-sm font-semibold hover:bg-red-600 transition">
                    üö™ D√©connexion
                </button>
            </div>
            
            <div class="space-y-4">
                <div class="bg-white rounded-2xl p-4">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-bold text-[#2D3436]">‚ößÔ∏è Genres</h3>
                        <button onclick="showAddOptionModal('gender')" class="px-3 py-1 bg-[#FF4458] text-white rounded-full text-sm">+ Ajouter</button>
                    </div>
                    <div id="genderOptions" class="space-y-2">
                        <p class="text-[#2D3436] opacity-75 text-sm">Chargement...</p>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl p-4">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-bold text-[#2D3436]">üôè Religions</h3>
                        <button onclick="showAddOptionModal('religion')" class="px-3 py-1 bg-[#FF4458] text-white rounded-full text-sm">+ Ajouter</button>
                    </div>
                    <div id="religionOptions" class="space-y-2">
                        <p class="text-[#2D3436] opacity-75 text-sm">Chargement...</p>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl p-4">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-bold text-[#2D3436]">üíï Types de Rencontre</h3>
                        <button onclick="showAddOptionModal('meeting_type')" class="px-3 py-1 bg-[#FF4458] text-white rounded-full text-sm">+ Ajouter</button>
                    </div>
                    <div id="meetingTypeOptions" class="space-y-2">
                        <p class="text-[#2D3436] opacity-75 text-sm">Chargement...</p>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl p-4">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-bold text-[#2D3436]">üéØ Centres d'Int√©r√™t</h3>
                        <button onclick="showAddOptionModal('interest')" class="px-3 py-1 bg-[#FF4458] text-white rounded-full text-sm">+ Ajouter</button>
                    </div>
                    <div id="interestOptions" class="space-y-2">
                        <p class="text-[#2D3436] opacity-75 text-sm">Chargement...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="page-reports" class="page-content hidden">
        <div class="px-4 pt-4 pb-4">
            <div class="flex items-center justify-between mb-4">
                <h1 class="text-2xl font-bold text-[#2D3436]">Signalements</h1>
                <button onclick="logout()" class="px-4 py-2 bg-red-500 text-white rounded-full text-sm font-semibold hover:bg-red-600 transition">
                    üö™ D√©connexion
                </button>
            </div>
            <div id="reportsList" class="space-y-3">
                <p class="text-[#2D3436] opacity-75">Chargement...</p>
            </div>
        </div>
    </div>

    <div id="addOptionModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-3xl w-full max-w-md m-4 p-6">
            <h3 class="text-xl font-bold text-[#2D3436] mb-4">Ajouter une Option</h3>
            <form onsubmit="addOption(event)">
                <input type="hidden" id="newOptionCategory">
                <div class="mb-3">
                    <label class="block text-[#2D3436] mb-2 text-sm font-semibold">Valeur (ID)</label>
                    <input type="text" id="newOptionValue" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:border-[#FF4458]" placeholder="ex: pansexual">
                </div>
                <div class="mb-4">
                    <label class="block text-[#2D3436] mb-2 text-sm font-semibold">Libell√©</label>
                    <input type="text" id="newOptionLabel" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:border-[#FF4458]" placeholder="ex: Pansexuel(le)">
                </div>
                <div class="flex gap-2">
                    <button type="button" onclick="closeAddOptionModal()" class="flex-1 py-3 bg-gray-200 text-[#2D3436] rounded-full">Annuler</button>
                    <button type="submit" class="flex-1 py-3 bg-[#FF4458] text-white rounded-full">Ajouter</button>
                </div>
            </form>
        </div>
    </div>

    <div id="userDetailsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-end z-50">
        <div class="bg-white rounded-t-3xl w-full p-6 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold text-[#2D3436]">D√©tails Utilisateur</h3>
                <button onclick="closeUserDetailsModal()" class="w-10 h-10 flex items-center justify-center bg-gray-100 text-gray-600 hover:bg-gray-200 rounded-full text-2xl font-bold transition-colors">√ó</button>
            </div>
            <div id="userDetailsContent" class="space-y-4">
                <p class="text-sm text-[#2D3436] opacity-75 text-center py-4">Chargement...</p>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="grid grid-cols-4 h-16">
            <button onclick="switchPage('dashboard')" id="nav-dashboard" class="nav-item active flex flex-col items-center justify-center">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
                <span class="text-xs mt-1">Stats</span>
            </button>
            <button onclick="switchPage('users')" id="nav-users" class="nav-item flex flex-col items-center justify-center">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                </svg>
                <span class="text-xs mt-1">Users</span>
            </button>
            <button onclick="switchPage('options')" id="nav-options" class="nav-item flex flex-col items-center justify-center">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                <span class="text-xs mt-1">Options</span>
            </button>
            <button onclick="switchPage('reports')" id="nav-reports" class="nav-item flex flex-col items-center justify-center">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>
                <span class="text-xs mt-1">Reports</span>
            </button>
        </div>
    </div>

    <script>
        let currentPage = 'dashboard';

        function checkAuth() {
            const token = localStorage.getItem('token');
            const userData = localStorage.getItem('user');
            if (!token || !userData) {
                window.location.href = '/';
                return;
            }
            const user = JSON.parse(userData);
            if (user.role !== 'admin') {
                window.location.href = '/app.html';
            }
        }

        function switchPage(page) {
            currentPage = page;
            
            document.querySelectorAll('.page-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(`page-${page}`).classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`nav-${page}`).classList.add('active');
            
            if (page === 'users') {
                loadUsers();
            } else if (page === 'reports') {
                loadReports();
            } else if (page === 'options') {
                loadProfileOptions();
            }
        }

        async function loadStats() {
            const token = localStorage.getItem('token');
            
            try {
                const usersResponse = await fetch('/api/admin/users', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (usersResponse.ok) {
                    const users = await usersResponse.json();
                    document.getElementById('totalUsers').textContent = users.length;
                    
                    const establishments = users.filter(u => u.role === 'establishment').length;
                    document.getElementById('totalEstablishments').textContent = establishments;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        async function loadUsers() {
            const token = localStorage.getItem('token');
            
            try {
                const response = await fetch('/api/admin/users', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const users = await response.json();
                    displayUsers(users);
                }
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        function displayUsers(users) {
            const list = document.getElementById('usersList');
            
            if (users.length === 0) {
                list.innerHTML = '<p class="text-[#2D3436] opacity-75">Aucun utilisateur</p>';
                return;
            }
            
            list.innerHTML = users.map(user => `
                <div class="bg-white rounded-2xl p-4">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-bold text-[#2D3436]">${user.name}</h4>
                        <span class="px-2 py-1 rounded-full text-xs font-semibold ${getRoleBadgeClass(user.role)}">
                            ${user.role}
                        </span>
                    </div>
                    <div class="text-sm text-[#2D3436] opacity-75 space-y-1 mb-3">
                        <div>üìß ${user.email}</div>
                        <div>üéÇ ${user.age || 'N/A'} ans ‚Ä¢ ${user.gender || 'N/A'}</div>
                        <div>üíé ${user.subscription_tier || 'free'}</div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="viewUserDetails(${user.id})" class="flex-1 py-2 bg-[#6C5CE7] text-white rounded-full text-sm font-semibold hover:bg-[#5f52d6] transition">
                            üëÅÔ∏è Voir
                        </button>
                        <button onclick="toggleUserBlock(${user.id}, ${user.is_blocked || false})" class="flex-1 py-2 ${user.is_blocked ? 'bg-green-500 hover:bg-green-600' : 'bg-yellow-500 hover:bg-yellow-600'} text-white rounded-full text-sm font-semibold transition">
                            ${user.is_blocked ? '‚úÖ D√©bloquer' : 'üö´ Bloquer'}
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function getRoleBadgeClass(role) {
            switch(role) {
                case 'admin': return 'bg-[#FF4458] text-white';
                case 'establishment': return 'bg-[#6C5CE7] text-white';
                default: return 'bg-[#00B894] text-white';
            }
        }

        async function loadReports() {
            const token = localStorage.getItem('token');
            
            try {
                const response = await fetch('/api/admin/reports', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const reports = await response.json();
                    displayReports(reports);
                    document.getElementById('totalReports').textContent = reports.length;
                }
            } catch (error) {
                console.error('Error loading reports:', error);
            }
        }

        function displayReports(reports) {
            const list = document.getElementById('reportsList');
            
            if (reports.length === 0) {
                list.innerHTML = '<p class="text-[#2D3436] opacity-75">Aucun signalement</p>';
                return;
            }
            
            list.innerHTML = reports.map(report => `
                <div class="bg-white rounded-2xl p-4 border-l-4 border-[#FF4458]">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-bold text-[#2D3436] capitalize">${report.report_type}</h4>
                        <span class="px-2 py-1 rounded-full text-xs font-semibold ${report.status === 'pending' ? 'bg-yellow-500 text-white' : 'bg-gray-300 text-[#2D3436]'}">
                            ${report.status}
                        </span>
                    </div>
                    <p class="text-sm text-[#2D3436] opacity-75 mb-2">${report.reason}</p>
                    <div class="text-xs text-[#2D3436] opacity-75">
                        Par ${report.reporter_name} ‚Ä¢ ${new Date(report.created_at).toLocaleDateString()}
                    </div>
                </div>
            `).join('');
        }

        async function loadProfileOptions() {
            const token = localStorage.getItem('token');
            
            try {
                const response = await fetch('/api/profile-options', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const options = await response.json();
                    displayProfileOptions(options);
                }
            } catch (error) {
                console.error('Error loading profile options:', error);
            }
        }

        function displayProfileOptions(options) {
            displayCategoryOptions('gender', options.gender || []);
            displayCategoryOptions('religion', options.religion || []);
            displayCategoryOptions('meeting_type', options.meeting_type || []);
            displayCategoryOptions('interest', options.interest || []);
        }

        function displayCategoryOptions(category, opts) {
            const containerMap = {
                'gender': 'genderOptions',
                'religion': 'religionOptions',
                'meeting_type': 'meetingTypeOptions',
                'interest': 'interestOptions'
            };
            const containerId = containerMap[category] || 'genderOptions';
            const container = document.getElementById(containerId);
            
            if (opts.length === 0) {
                container.innerHTML = '<p class="text-[#2D3436] opacity-75 text-sm">Aucune option</p>';
                return;
            }
            
            container.innerHTML = opts.map(opt => `
                <div class="flex items-center justify-between py-2 px-3 bg-gray-50 rounded-xl">
                    <div>
                        <span class="font-semibold text-[#2D3436]">${opt.label}</span>
                        <span class="text-xs text-gray-500 ml-2">(${opt.value})</span>
                    </div>
                    <button onclick="toggleOption(${opt.id}, ${opt.is_active})" class="px-3 py-1 rounded-full text-xs ${opt.is_active ? 'bg-green-500 text-white' : 'bg-gray-300 text-[#2D3436]'}">
                        ${opt.is_active ? 'Actif' : 'D√©sactiv√©'}
                    </button>
                </div>
            `).join('');
        }

        function showAddOptionModal(category) {
            document.getElementById('newOptionCategory').value = category;
            document.getElementById('addOptionModal').classList.remove('hidden');
        }

        function closeAddOptionModal() {
            document.getElementById('addOptionModal').classList.add('hidden');
            document.getElementById('newOptionValue').value = '';
            document.getElementById('newOptionLabel').value = '';
        }

        async function addOption(e) {
            e.preventDefault();
            const token = localStorage.getItem('token');
            
            const data = {
                category: document.getElementById('newOptionCategory').value,
                value: document.getElementById('newOptionValue').value,
                label: document.getElementById('newOptionLabel').value
            };
            
            try {
                const response = await fetch('/api/profile-options', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    closeAddOptionModal();
                    loadProfileOptions();
                    alert('Option ajout√©e avec succ√®s!');
                } else {
                    const error = await response.json();
                    alert(error.message || 'Erreur lors de l\'ajout');
                }
            } catch (error) {
                console.error('Error adding option:', error);
                alert('Erreur de connexion');
            }
        }

        async function toggleOption(optionId, currentStatus) {
            const token = localStorage.getItem('token');
            
            try {
                const response = await fetch(`/api/profile-options/${optionId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ is_active: !currentStatus })
                });
                
                if (response.ok) {
                    loadProfileOptions();
                }
            } catch (error) {
                console.error('Error toggling option:', error);
            }
        }

        async function viewUserDetails(userId) {
            const token = localStorage.getItem('token');
            
            try {
                const response = await fetch(`/api/admin/users/${userId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const user = await response.json();
                    displayUserDetails(user);
                    document.getElementById('userDetailsModal').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error loading user details:', error);
                alert('Erreur lors du chargement des d√©tails');
            }
        }

        function displayUserDetails(user) {
            const content = document.getElementById('userDetailsContent');
            content.innerHTML = `
                <div class="bg-white rounded-2xl p-4 border border-gray-200">
                    ${user.photo_url ? `<img src="${user.photo_url}" class="w-32 h-32 rounded-full mx-auto mb-4 object-cover">` : '<div class="w-32 h-32 rounded-full mx-auto mb-4 bg-gray-200 flex items-center justify-center text-4xl">üë§</div>'}
                    <h3 class="text-xl font-bold text-center text-[#2D3436] mb-4">${user.name}</h3>
                    
                    <div class="space-y-3 text-[#2D3436]">
                        <div class="flex justify-between py-2 border-b">
                            <span class="font-semibold">Email:</span>
                            <span>${user.email}</span>
                        </div>
                        <div class="flex justify-between py-2 border-b">
                            <span class="font-semibold">R√¥le:</span>
                            <span class="px-2 py-1 rounded-full text-xs font-semibold ${getRoleBadgeClass(user.role)}">${user.role}</span>
                        </div>
                        <div class="flex justify-between py-2 border-b">
                            <span class="font-semibold">√Çge:</span>
                            <span>${user.age || 'N/A'} ans</span>
                        </div>
                        <div class="flex justify-between py-2 border-b">
                            <span class="font-semibold">Genre:</span>
                            <span>${user.gender || 'N/A'}</span>
                        </div>
                        <div class="flex justify-between py-2 border-b">
                            <span class="font-semibold">Abonnement:</span>
                            <span class="uppercase font-bold">${user.subscription_tier || 'free'}</span>
                        </div>
                        ${user.bio ? `
                        <div class="py-2 border-b">
                            <span class="font-semibold block mb-2">Bio:</span>
                            <p class="text-sm opacity-75">${user.bio}</p>
                        </div>` : ''}
                        <div class="flex justify-between py-2 border-b">
                            <span class="font-semibold">Inscription:</span>
                            <span class="text-sm">${new Date(user.created_at).toLocaleDateString()}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function closeUserDetailsModal() {
            document.getElementById('userDetailsModal').classList.add('hidden');
        }

        async function toggleUserBlock(userId, isCurrentlyBlocked) {
            const action = isCurrentlyBlocked ? 'd√©bloquer' : 'bloquer';
            if (!confirm(`Voulez-vous vraiment ${action} cet utilisateur ?`)) {
                return;
            }

            const token = localStorage.getItem('token');
            
            try {
                const response = await fetch(`/api/admin/users/${userId}/block`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ is_blocked: !isCurrentlyBlocked })
                });
                
                if (response.ok) {
                    alert(`Utilisateur ${action === 'bloquer' ? 'bloqu√©' : 'd√©bloqu√©'} avec succ√®s!`);
                    loadUsers();
                } else {
                    const error = await response.json();
                    alert(error.message || `Erreur lors du ${action}`);
                }
            } catch (error) {
                console.error('Error toggling user block:', error);
                alert('Erreur de connexion');
            }
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '/';
        }

        checkAuth();
        loadStats();
    </script>
</body>
</html>
