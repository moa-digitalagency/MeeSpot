# Changelog - MatchSpot

Ce fichier documente toutes les modifications, corrections et am√©liorations apport√©es au projet MatchSpot.

## Instructions
**Important**: Ce fichier doit √™tre mis √† jour √† chaque modification importante du code, correction de bug, ou ajout de fonctionnalit√©.

---

## [11 Octobre 2025 - 09:00 UTC] - Corrections Profil √âtablissement et Limites Forfaits

### üêõ Corrections de bugs
- **Fix erreur de r√©cup√©ration des membres de room**
  - Probl√®me: Tentative d'acc√®s √† `member.user.name` causait des erreurs potentielles
  - Solution: Ajout de v√©rification `if member.user` et retour du genre au lieu du nom pour les statistiques
  - Fichier modifi√©: `backend/routes/establishments.py` (lignes 304-331)

- **Fix champ photo_url manquant dans l'API**
  - Probl√®me: La r√©ponse de `/api/establishments/me` ne retournait pas le `photo_url`
  - Solution: Ajout du champ `photo_url` dans la r√©ponse JSON
  - Fichier modifi√©: `backend/routes/establishments.py` (ligne 155)

- **Fix conflit de noms de fonction JavaScript**
  - Probl√®me: Deux fonctions nomm√©es `updateProfile()` causaient des conflits
  - Solution: Renommage de la fonction d'affichage en `updateProfileDisplay()`
  - Fichier modifi√©: `static/pages/establishment.html` (lignes 511, 445, 1048)

### ‚úÖ V√©rifications
- **Syst√®me de param√®tres du profil √©tablissement**
  - ‚úÖ Modal fonctionnel permettant de modifier nom, description et photo
  - ‚úÖ Photo t√©l√©charg√©e devient la photo par d√©faut pour toutes les rooms cr√©√©es
  - ‚úÖ Bouton "‚öôÔ∏è Param√®tres du profil" accessible dans l'onglet Profil

- **Limites de forfaits √©tablissements**
  - ‚úÖ **One-Shot**: 1 room/jour avec message si limite atteinte + option d'achat
  - ‚úÖ **Silver**: 3 rooms/semaine (cycle de 7 jours) avec compteur et jours restants
  - ‚úÖ **Gold**: 7 rooms/semaine (cycle de 7 jours) avec compteur et jours restants
  - ‚úÖ **Aucun forfait**: Message invitant √† acheter un forfait
  - ‚úÖ **Limite atteinte**: Option d'acheter un One-Shot accessible directement dans le profil

### üìã Fichiers Modifi√©s
- `backend/routes/establishments.py` - Corrections API membres et photo_url
- `static/pages/establishment.html` - Correction conflit fonction JavaScript

### üì¶ Commandes de D√©ploiement VPS

#### Mise √† jour du code depuis GitHub
```bash
# Se connecter au VPS via SSH
ssh user@votre-serveur.com

# Aller dans le r√©pertoire du projet
cd /chemin/vers/matchspot

# Sauvegarder la configuration actuelle
cp .env .env.backup

# R√©cup√©rer les derni√®res modifications
git pull origin main

# Installer/mettre √† jour les d√©pendances si n√©cessaire
pip install -r requirements.txt
```

#### Migration de la base de donn√©es
```bash
# Si vous utilisez Flask-Migrate (recommand√©)
flask db upgrade

# OU si migration manuelle n√©cessaire
# Connectez-vous √† PostgreSQL et ex√©cutez les requ√™tes SQL n√©cessaires
psql $DATABASE_URL

# Red√©marrer l'application
sudo systemctl restart matchspot
# OU si vous utilisez gunicorn directement
pkill -HUP gunicorn
```

#### V√©rification apr√®s d√©ploiement
```bash
# V√©rifier les logs
tail -f /var/log/matchspot/error.log

# V√©rifier que l'application r√©pond
curl http://localhost:5000/

# V√©rifier le statut du service
sudo systemctl status matchspot
```

---

## [10 Octobre 2025 - 23:00 UTC] - D√©placement Carrousel Profils vers Landing Page

### üë• Section Profils Inscrits - Landing Page
- **D√©placement du carrousel du dashboard vers la landing page**
  - Section ajout√©e apr√®s "Comment √ßa marche" et avant "Plans d'adh√©sion"
  - Titre: "üë• Ils sont d√©j√† inscrits"
  - Description: "Rejoignez une communaut√© diverse et authentique"
  - 6 profils avec photos r√©elles diversifi√©es (Sophie, Malik, Emma, Yuki, Carlos, Amara)
  - Photos g√©n√©r√©es et stock√©es dans `static/images/profiles/`
  - Animation scroll infini (40s) avec duplication des profils
  - Design: cartes 140px avec photos 128x128px arrondies, overlay gradient pour noms/√¢ges
  - Call-to-action: "Rejoignez-nous maintenant üöÄ"

### üóëÔ∏è Nettoyage Dashboard Utilisateur
- **Retrait du carrousel du dashboard app**
  - Carrousel retir√© de `static/pages/app.html` 
  - Fonction JavaScript `initProfileCarousel()` supprim√©e
  - Focus du dashboard sur les fonctionnalit√©s utilisateur (rooms, messages)

### üìã Fichiers Modifi√©s
- `static/pages/index.html` - Ajout section profils avec carrousel + JS
- `static/pages/app.html` - Retrait carrousel et code JS associ√©
- `static/images/profiles/` - 6 nouvelles photos de profils diversifi√©s
- `CHANGELOG.md` - Documentation

### ‚úÖ Tests
- ‚úÖ Application red√©marr√©e avec succ√®s
- ‚úÖ Landing page affiche le carrousel correctement
- ‚úÖ Animation infinie fonctionne
- ‚úÖ Dashboard utilisateur nettoy√©

---

## [10 Octobre 2025 - 22:52 UTC] - Am√©liorations UX et Corrections

### üîß Correction Toggle Consentement Photos
- **Ajout de la route manquante `/api/profile/photo-consent`**
  - Endpoint POST pour activer/d√©sactiver le consentement photos
  - Toggle fonctionnel qui inverse l'√©tat actuel (`photo_consent_enabled`)
  - Par d√©faut: OFF (d√©j√† configur√© dans le mod√®le User)
  - Fichier modifi√©: `backend/routes/profile.py` (lignes 138-147)

### üé® Logo Mode Sombre
- **Ajout du logo sp√©cifique pour le mode dark**
  - Nouveau logo avec texte blanc pour meilleure visibilit√© en mode sombre
  - Fichier ajout√©: `static/images/logo-dark.png`
  - CSS pour affichage/masquage automatique selon le th√®me actif
  - Fichiers modifi√©s: `static/pages/app.html` (lignes 56-58, 88-89)

### ‚è≥ Ic√¥ne V√©rification En Attente
- **Remplacement de l'ic√¥ne orange par un sablier**
  - Les utilisateurs avec v√©rification "pending" affichent maintenant ‚è≥ au lieu d'un badge orange
  - Badge gris avec emoji sablier pour meilleure compr√©hension visuelle
  - Fichier modifi√©: `static/pages/app.html` (lignes 722-727)

### üì± Correction Popup PWA Install
- **R√©apparition du popup apr√®s 7 jours**
  - Ancien syst√®me: popup ne s'affichait plus jamais apr√®s dismiss
  - Nouveau syst√®me: utilise `pwa_install_dismissed_date` avec v√©rification de 7 jours
  - Le popup r√©appara√Æt si dernier dismiss > 7 jours ou jamais dismissed
  - Fichiers modifi√©s: `static/pages/app.html` (lignes 2456-2468, 2482-2484)

### üë• Carrousel Profils Dashboard
- **Ajout d'un carrousel infini de profils al√©atoires**
  - Section "‚ú® Profils d√©j√† inscrits" dans le dashboard
  - 10 profils avec noms diversifi√©s (Sophie, Malik, Emma, Yuki, Carlos, Amara, Liam, Priya, Ahmed, Zoe)
  - Animation scroll infini avec boucle continue (30s)
  - Avatars color√©s avec d√©grad√©s vari√©s repr√©sentant diff√©rentes ethnicit√©s
  - Fichiers modifi√©s: 
    - `static/pages/app.html` (lignes 60-64 pour CSS, 120-126 pour HTML, 2603-2631 pour JS)

### üìã Fichiers Modifi√©s
- `backend/routes/profile.py` - Ajout route photo-consent
- `static/pages/app.html` - Logo dark, ic√¥ne sablier, popup PWA, carrousel
- `static/images/logo-dark.png` - Nouveau logo mode sombre

### ‚úÖ Tests
- ‚úÖ Application red√©marr√©e avec succ√®s
- ‚úÖ Toutes les modifications charg√©es sans erreur
- ‚úÖ Workflow "Start application" en cours d'ex√©cution

---

## [10 Octobre 2025 - 22:20 UTC] - Mise √† Jour Favicon + Documentation

### üé® Nouveau Favicon (uniquement)
- **Nouveau favicon multicolore pour l'ic√¥ne du navigateur**
  - Favicon avec d√©grad√© moderne : bleu, violet, rose, vert
  - Design c≈ìur central blanc avec bords color√©s
  - Fichier mis √† jour : `static/images/favicon.png`
  - Toutes les tailles d'ic√¥nes PWA mises √† jour (72, 96, 128, 144, 152, 192, 384, 512px)
  - **Le logo principal (landing page + dashboard) reste inchang√©** : logo original MatchSpot

### üìö Consolidation Documentation
- **Simplification des guides de d√©ploiement**
  - Suppression du fichier redondant `DEPLOIEMENT_EXTERNE.md`
  - Enrichissement de `DEPLOYMENT_VPS.md` comme guide unique de d√©ploiement externe
  - Titre mis √† jour : "D√©ploiement Externe (VPS, Cloud, Serveur D√©di√©)"
  - Ajout de la section "Portabilit√© des Secrets" avec avertissements critiques
  - Documentation mise √† jour dans `replit.md` pour pointer vers les bons fichiers

---

## [10 Octobre 2025 - 22:00 UTC] - Portabilit√© et D√©ploiement Externe

### üîß Configuration Am√©lior√©e
- **Support SECRET_KEY pour d√©ploiement externe**
  - L'application utilise maintenant `SECRET_KEY` comme variable principale
  - Fallback automatique vers `SESSION_SECRET` pour compatibilit√© Replit
  - Permet le d√©ploiement en dehors de Replit sans erreurs
  - Fichier modifi√©: `backend/__init__.py` (ligne 55)

### üìö Documentation de D√©ploiement
- **Guide de d√©ploiement externe am√©lior√©**
  - Fichier `DEPLOYMENT_VPS.md` enrichi avec instructions de portabilit√©
  - Explique comment r√©cup√©rer et utiliser les m√™mes secrets depuis Replit
  - Guide de migration de base de donn√©es avec pg_dump/restore
  - Instructions pour VPS, Cloud, et Serveur D√©di√©
  - ‚ö†Ô∏è Avertissements critiques sur l'importance d'ENCRYPTION_KEY identique

- **Script de v√©rification de configuration**
  - Nouveau fichier: `verify_config.py` pour valider l'environnement
  - V√©rifie toutes les variables requises (SECRET_KEY/SESSION_SECRET, ENCRYPTION_KEY, DATABASE_URL)
  - Indique les variables manquantes et leur criticit√©
  - Commande: `python verify_config.py`

- **Am√©lioration .env.example**
  - Ajout de notes explicatives sur SECRET_KEY vs SESSION_SECRET
  - Clarification sur l'importance critique d'ENCRYPTION_KEY identique
  - Warnings visuels pour attirer l'attention sur les points critiques
  - Fichier modifi√©: `.env.example`

### üìñ Documentation Projet
- **Mise √† jour replit.md**
  - Section d√©di√©e "D√©ploiement Externe (Hors Replit)"
  - Instructions claires pour la portabilit√© des secrets
  - Liens vers les nouveaux guides de d√©ploiement
  - Avertissements sur ENCRYPTION_KEY et donn√©es chiffr√©es
  - Fichier modifi√©: `replit.md` (lignes 68-95)

### ‚úÖ R√©sultats
- ‚úÖ L'application fonctionne identiquement sur Replit et en externe
- ‚úÖ Les m√™mes secrets permettent d'acc√©der aux m√™mes donn√©es chiffr√©es
- ‚úÖ Migration de donn√©es facilit√©e avec documentation compl√®te
- ‚úÖ Validation de configuration automatis√©e
- ‚úÖ Compatible avec tous les h√©bergeurs (PythonAnywhere, Railway, VPS, etc.)

---

## [10 Octobre 2025 - 18:00 UTC] - Nouveau design avec logo multicolore

### ‚úçÔ∏è Contenu et Messages
- **Refonte du message principal du hero**
  - Nouveau titre: "Vos lieux. Vos matchs. Pas du swipe"
  - Nouveau sous-titre: "Chaque lieu devient une opportunit√© de rencontre authentique."
  - Message plus percutant et concis qui diff√©rencie clairement la plateforme

### üéØ Interface Utilisateur
- **Dashboard utilisateur am√©lior√©**
  - Ajout du logo multicolore avant le titre "Accueil"
  - Barre verticale comme s√©parateur entre le logo et le texte
  - Am√©lioration visuelle de l'en-t√™te du dashboard

### üé® Design et Identit√© visuelle
- **Nouveau logo et favicon multicolore**
  - Logo avec d√©grad√© vibrant : rose, violet, bleu cyan, vert turquoise
  - Favicon mis √† jour sur toutes les pages
  - Fichiers ajout√©s: `static/images/logo.png`, `static/images/favicon.png`

- **Nouvelle palette de couleurs**
  - Rose principal: #FF4081 (remplace #FF4458)
  - Violet: #5B4DFF (remplace #6C5CE7)
  - Bleu cyan: #00D4FF (remplace #A29BFE)
  - Vert turquoise: #00E5A0
  - D√©grad√©s enrichis avec 3+ couleurs pour plus de profondeur

- **Mise √† jour de toutes les pages**
  - index.html: Hero avec d√©grad√© from-[#FF4081] via-[#5B4DFF] to-[#00D4FF]
  - app.html: Logo dans l'invite d'installation PWA
  - establishment.html: Couleurs adapt√©es
  - admin.html: Couleurs adapt√©es
  - manifest.json: theme_color mis √† jour

---

## [10 Octobre 2025 - 17:30 UTC] - Am√©liorations UI et QR Code

### üé® Am√©liorations UI
- **Repositionnement de l'indicateur de notification**
  - L'indicateur de messages non lus (point rouge) a √©t√© d√©plac√© du coin de la photo de profil vers le c√¥t√© droit de la ligne de message
  - Design plus √©pur√© et professionnel
  - Fichier modifi√©: `static/pages/app.html` (lignes 1368-1390)

### üì± QR Code √âtablissements
- **Am√©lioration de la mise en page du QR code t√©l√©chargeable**
  - Ajout d'une ligne horizontale s√©paratrice au-dessus du texte d'instructions
  - Le site web www.thematchspot.com est maintenant affich√© en dessous du texte "pour rejoindre cette room"
  - Design plus structur√© et professionnel
  - **R√©solution augment√©e x4** (1600x2000 pixels) pour une qualit√© d'impression professionnelle
  - Fichier modifi√©: `static/pages/establishment.html` (lignes 658-705)

---

## [10 Octobre 2025 - 17:03 UTC] - Mise √† jour compl√®te des tarifs d'abonnement

### üí∞ Changements tarifaires
- **Plans Utilisateurs**
  - Free: $0/mois - Conservation conversations 24h (inchang√©)
  - Premium: $19 ‚Üí $4.99/mois - Conservation 7 jours + filtres + identit√© alternative
  - Platinum: $39 ‚Üí $9.99/mois - Conservation 30 jours + filtres + visibilit√© prioritaire + identit√© alternative

- **Plans √âtablissements**
  - Single Shot: $9 ‚Üí $19 CAD - 1 code (24h)
  - Silver: $49 CAD - 3 codes/semaine (limite quotidienne: 1/jour)
  - Gold: $99 CAD - 7 codes/semaine (1 code/jour)

### üîß Am√©liorations techniques
- **Suppression des valeurs hardcod√©es**
  - Les limites de cr√©ation de rooms proviennent maintenant de la base de donn√©es (SubscriptionPlan.rooms_per_day)
  - Fichier modifi√©: `backend/routes/establishments.py` (lignes 58-63, 144-149)
  - Les valeurs ne sont plus en dur dans le code, facilitant les changements futurs

- **Mise √† jour de l'initialisation**
  - Fichier modifi√©: `backend/__init__.py` (lignes 96-98, 107-109)
  - Les nouveaux environnements utilisent automatiquement les tarifs corrects
  - Base de donn√©es existantes mises √† jour via SQL

### üìù Notes techniques
- Le syst√®me actuel suit les limites quotidiennes pour les √©tablissements
- Plans hebdomadaires (Silver: 3/semaine, Gold: 7/semaine) limit√©s √† 1/jour actuellement
- Une future am√©lioration pourrait impl√©menter un vrai suivi hebdomadaire

---

## [10 Octobre 2025 - 16:54 UTC] - Fix endpoint √©tablissements

### üêõ Corrections de bugs
- **Fix erreur 403 sur changement de forfait (√©tablissements)**
  - Probl√®me: Les √©tablissements utilisaient l'endpoint admin `/api/admin/plans` qui n√©cessite des droits administrateur
  - Solution: Changement vers l'endpoint public `/api/subscriptions/plans` accessible aux √©tablissements
  - Fichier modifi√©: `static/pages/establishment.html` (ligne 817)
  - Erreur corrig√©e: `GET /api/admin/plans 403 (FORBIDDEN)`

---

## [10 Octobre 2025] - Syst√®me de notifications et param√®tres de messages

### üéØ Fonctionnalit√©s ajout√©es
- **Syst√®me de notifications pour messages non lus**
  - Badge rouge avec compteur sur chaque conversation contenant des messages non lus
  - Badge de notification sur l'onglet Messages dans le menu de navigation
  - Le compteur dispara√Æt automatiquement quand les messages sont lus
  - Fichiers modifi√©s: 
    - `backend/models/private_conversation.py` (ajout de `unread_count`)
    - `static/pages/app.html` (affichage des badges et notifications)

### üîß Am√©liorations
- **Param√®tre "Recevoir des photos" d√©sactiv√© par d√©faut**
  - Pour plus de confidentialit√©, le toggle est maintenant OFF par d√©faut pour les nouveaux utilisateurs
  - Les utilisateurs doivent explicitement l'activer pour recevoir des photos
  - Fichier modifi√©: `backend/models/user.py` (ligne 45: `default=False`)

---

## [10 Octobre 2025] - Corrections critiques

### üêõ Corrections de bugs
- **Fix du chargement infini des participants dans les rooms**
  - Probl√®me: L'auto-refresh v√©rifiait le mauvais √©l√©ment DOM (`participantsList` au lieu de `participantsModal`)
  - Solution: Correction de la v√©rification pour utiliser `participantsModal` dans `startAutoRefresh()`
  - Fichier: `static/pages/app.html` ligne 2449

- **Fix de la gestion d'erreur pour les plans d'abonnement**
  - Probl√®me: Pas de v√©rification du statut de la r√©ponse HTTP lors du chargement des plans
  - Solution: Ajout de v√©rification `if (!plansRes.ok || !requestsRes.ok)` avant le traitement des donn√©es
  - Fichier: `static/pages/app.html` ligne 1941-1943

### üîê S√©curit√©
- **Ajout des cl√©s secr√®tes manquantes**
  - Ajout de `SECRET_KEY` dans les secrets Replit pour la s√©curit√© des sessions Flask
  - Ajout de `ENCRYPTION_KEY` dans les secrets Replit pour le chiffrement des donn√©es sensibles
  - Ces cl√©s sont maintenant disponibles comme variables d'environnement

### üì¶ D√©ploiement
- **Configuration du d√©ploiement Replit**
  - Type: Autoscale (pour sites web stateless)
  - Commande: `gunicorn --bind 0.0.0.0:5000 main:app`
  - Les secrets sont synchronis√©s entre l'environnement de d√©veloppement et le d√©ploiement

### üìù Documentation
- **Cr√©ation du fichier CHANGELOG.md**
  - Documentation de toutes les modifications et corrections
  - Instructions pour maintenir ce fichier √† jour
  
- **Mise √† jour de replit.md**
  - Ajout de l'instruction de toujours mettre √† jour CHANGELOG.md
  - Documentation des secrets requis

---

## Template pour futures modifications

```markdown
## [DATE] - Titre de la modification

### üéØ Fonctionnalit√©s ajout√©es
- Description de la nouvelle fonctionnalit√©
- Fichiers modifi√©s: `chemin/vers/fichier.py`

### üêõ Corrections de bugs
- Description du bug corrig√©
- Fichiers modifi√©s: `chemin/vers/fichier.py`

### üîß Am√©liorations
- Description de l'am√©lioration
- Fichiers modifi√©s: `chemin/vers/fichier.py`

### üîê S√©curit√©
- Description de la modification de s√©curit√©
- Fichiers modifi√©s: `chemin/vers/fichier.py`
```

---

## L√©gende des emojis
- üéØ Nouvelle fonctionnalit√©
- üêõ Correction de bug
- üîß Am√©lioration/Optimisation
- üîê S√©curit√©
- üì¶ D√©ploiement
- üìù Documentation
- ‚ö†Ô∏è Avertissement/D√©pr√©ciation
- üóëÔ∏è Suppression
